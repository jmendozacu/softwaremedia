<?php /* !!!ATTENTION!!! PLEASE DO NOT MODIFY THE FILE! 
Copy it preserving its path from the var/ait_path folder to the
app folder. i.e. in var/ait_path folder the file is located in folder 1, 
then in the app folder you also need to make folder 1 and put the file in it.
*/ ?><?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<?php
/**
 * Multishipping checkout billing information
 *
 * @see Mage_Checkout_Block_Multishipping_Billing
 */
?>
<div class="page-title">
    <h1><?php echo $this->__('Billing Information') ?></h1>
</div>
<?php echo $this->getMessagesBlock()->getGroupedHtml() ?>

<?php /* START AITOC COMMENTING
<script src="<?php echo Mage::getBaseUrl('js') ?>varien/payment.js" type="text/javascript"></script>
FINISH AITOC COMMENTING */ ?> 

<!--     START AITOC CHECKOUT ATTRIBUTES     -->
    <script type="text/javascript">
    //<![CDATA[
    var paymentForm = Class.create();
    paymentForm.prototype = {
        initialize: function(formId){
            this.formId = formId;
            this.validator = new Validation(this.formId);
            var elements = Form.getElements(formId);

            var method = null;
            for (var i=0; i<elements.length; i++) {
            	if ((elements[i].name=='payment[method]')||(elements[i].name.indexOf('aitoc_checkout_')!=-1)) {
                    if (elements[i].checked) {
                        method = elements[i].value;
                    }
                } else {
                    if(elements[i].tagName!="BUTTON"){elements[i].disabled = true;}
                }
                if(elements[i].tagName!="BUTTON"){elements[i].setAttribute('autocomplete','off');}
            }
            if (method) this.switchMethod(method);
        },

        switchMethod: function(method){
            if (this.currentMethod && $('payment_form_'+this.currentMethod)) {
                var form = $('payment_form_'+this.currentMethod);
                form.style.display = 'none';
                var elements = form.getElementsByTagName('input');
                for (var i=0; i<elements.length; i++) elements[i].disabled = true;
                var elements = form.getElementsByTagName('select');
                for (var i=0; i<elements.length; i++) elements[i].disabled = true;

            }
            if ($('payment_form_'+method)){
                var form = $('payment_form_'+method);
                form.style.display = '';
                var elements = form.getElementsByTagName('input');
                for (var i=0; i<elements.length; i++) elements[i].disabled = false;
                var elements = form.getElementsByTagName('select');
                for (var i=0; i<elements.length; i++) elements[i].disabled = false;
                this.currentMethod = method;
            }
        }
    }
    //]]>
    </script>
<!--     FINISH AITOC CHECKOUT ATTRIBUTES     -->

<div class="multiple-checkout">
<form action="<?php echo $this->getPostActionUrl() ?>" method="post" id="multishipping-billing-form">

<!--     START AITOC CHECKOUT ATTRIBUTES     -->
    <?php if ($aFieldList = $this->getCustomFieldList(1)): ?>
    <fieldset>
        <ul class="form-list">
        <?php foreach ($aFieldList as $aField): ?>
            <?php echo $this->getFieldHtml($aField); ?>
        <?php endforeach; ?>
        </ul>                
    </fieldset>
    <?php endif; ?>
<!--     FINISH AITOC CHECKOUT ATTRIBUTES     -->          

<div class="col2-set">
    <div class="col-1 narrow">
        <div class="info-box">
            <h2 class="box-title"><?php echo $this->__('Billing Address') ?> <span class="separator">|</span> <a href="<?php echo $this->getSelectAddressUrl() ?>"><?php echo $this->__('Change') ?></a></h2>
            <?php $_address=$this->getAddress() ?>
            <address class="box-content"><?php echo $_address->format('html') ?></address>
        </div>
    </div>
    <script type="text/javascript">
    //<![CDATA[
        var quoteBaseGrandTotal = <?php echo (float)$this->getQuoteBaseGrandTotal(); ?>;
      //]]>
    </script>
    <div class="col-2 wide">
        <div class="info-box">
            <h2 class="box-title"><?php echo $this->__('Payment Method') ?></h2>
            <div class="box-content">
                <div class="tool-tip" id="payment-tool-tip" style="display:none;">
                    <div class="btn-close"><a href="#" id="payment-tool-tip-close"><img src="<?php echo $this->getSkinUrl('images/btn_window_close.gif') ?>" alt="<?php echo $this->__('Close') ?>" title="<?php echo $this->__('Close') ?>" /></a></div>
                    <div class="tool-tip-content"><img src="<?php echo $this->getSkinUrl('images/cvv.gif') ?>" alt="<?php echo $this->__('Card Verification Number Visual Reference') ?>" title="<?php echo $this->__('Card Verification Number Visual Reference') ?>" /></div>
                </div>
                <?php echo $this->getChildHtml('payment_methods_before') ?>
                <!-- Payment methods forms list -->
                <dl class="sp-methods" id="payment-methods">
                <?php
                    $_methods       = $this->getMethods();
                    $_methodsCount  = count($_methods);
                ?>
                <?php foreach ($_methods as $_method): $_code = $_method->getCode() ?>
                    <dt>
                        <?php if ($_methodsCount > 1): ?>
                        <input type="radio" id="p_method_<?php echo $_code ?>" value="<?php echo $_code ?>" name="payment[method]" title="<?php echo $this->htmlEscape($_method->getTitle()) ?>" onclick="payment.switchMethod('<?php echo $_code ?>')"<?php if($this->getSelectedMethodCode()==$_code): ?> checked="checked"<?php endif; ?> class="radio" />
                        <?php else :?>
                        <span class="no-display"><input type="radio" id="p_method_<?php echo $_code ?>" value="<?php echo $_code ?>" name="payment[method]" checked="checked" class="radio" /></span>
                        <?php endif;?>
                        <label for="p_method_<?php echo $_code ?>"><?php echo $_method->getTitle() ?></label>
                    </dt>
                    <?php if($html = $this->getChildHtml('payment.method.'.$_code)) : ?>
                    <dd>
                        <?php echo $html; ?>
                    </dd>
                    <?php endif; ?>
                <?php endforeach; ?>
                </dl>
                <?php echo $this->getChildHtml('payment_methods_after') ?>
                <?php echo $this->getChildHtml('checkout_billing_items') ?>
            </div>
        </div>
    </div>
</div>

<!--     START AITOC CHECKOUT ATTRIBUTES     -->
    <?php if ($aFieldList = $this->getCustomFieldList(2)): ?>
    <fieldset>
        <ul class="form-list">
        <?php foreach ($aFieldList as $aField): ?>
            <?php echo $this->getFieldHtml($aField); ?>
        <?php endforeach; ?>
        </ul>                
    </fieldset>
    <?php endif; ?>
<!--     FINISH AITOC CHECKOUT ATTRIBUTES     -->          

<div class="buttons-set">
    <p class="back-link"><a href="<?php echo $this->getBackUrl() ?>"><small>&laquo; </small><?php echo $this->__('Back to Shipping Information') ?></a></p>
    <button type="submit" class="button"><span><span><?php echo $this->__('Continue to Review Your Order') ?></span></span></button>
</div>
</form>
</div>
<script type="text/javascript">
//<![CDATA[
    var payment = new paymentForm('multishipping-billing-form');
    function toggleToolTip(event){
        if($('payment-tool-tip')){
            /*$('payment-tool-tip').setStyle({
                top: (Event.pointerY(event)-510)+'px',
                left: (Event.pointerX(event)-800)+'px'
            })*/
            $('payment-tool-tip').toggle();
        }
        Event.stop(event);
    }
    if($('payment-tool-tip-close')){
        Event.observe($('payment-tool-tip-close'), 'click', toggleToolTip);
    }
    $$('.cvv-what-is-this').each(function(element){
        Event.observe(element, 'click', toggleToolTip);
    });
//]]>
</script>
